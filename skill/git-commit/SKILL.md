---
name: git-commit
description: 执行 Git 代码提交工作流。每当用户请求 "commit"、"提交"、"保存变更" 时，必须优先使用此技能。它会自动分析暂存区、生成符合规范的中文提交信息并完成提交。
---

请严格按照以下步骤顺序执行，**不要跳过任何判断**：

### 1. 状态检测与暂存策略 (Check & Stage Strategy)
你需要通过执行命令来明确区分“已暂存”和“未暂存”的内容。

1.  **第一步：检查暂存区**
    *   执行命令：`git diff --cached --name-only`
    *   **判断逻辑**：
        *   **如果有输出**（即暂存区有文件）：
            *   ✅ **锁定范围**：接下来的分析和提交**仅针对**这些已暂存的文件。
            *   🚫 **禁止操作**：不要执行 `git add`，保持暂存区现状。
        *   **如果没有输出**（即暂存区为空）：
            *   执行命令：`git status --porcelain`
            *   如果输出为空：🛑 终止流程，告知用户无变更。
            *   如果输出不为空（有未暂存或未追踪的文件）：
                *   执行命令：`git add .`
                *   ✅ **锁定范围**：接下来的分析针对所有文件。

### 2. 深度上下文分析 (Deep Context Analysis)
不要只看 diff 的表面，你需要理解代码的**意图**。

1.  获取变更内容：
    *   如果刚才锁定的范围是“原暂存区”，使用 `git diff --cached`。
    *   如果刚才执行了 `git add .`，同样使用 `git diff --cached`。
2.  **关键：读取文件上下文**
    *   对于 diff 中修改的核心文件，**必须**使用文件读取工具（如 `read_file`）查看修改处前后的完整代码，以区分 `fix`、`feat` 或 `refactor`。

### 3. 历史风格一致性校验 (Historical Consistency Check)
1.  **获取历史记录**
    *   执行命令：`git log -n 10`
2.  **分析一致性模式**：
    *   **Scope (范围) 习惯**：观察之前的提交是如何定义范围的。
        *   *例如*：是使用文件名 `(user-controller)`，还是模块名 `(auth)`，还是目录简写 `(api)`？你生成的 Scope 必须遵循此模式。
    *   **描述粒度**：观察之前的描述是偏向“技术实现细节”还是“业务价值”。
    *   **特殊标记**：检查是否有项目特定的前缀或 ID 引用要求（如果本次 Prompt 规范未覆盖）。

### 4. 生成提交信息 (Generate Message)
基于 **深度分析(Step 2)** 和 **历史一致性(Step 3)** 的结果，构建符合 **Conventional Commits** 和 **Emoji** 规范的提交信息。

*   **语言要求**：必须使用 **中文**。
*   **一致性强制要求**：
    *   **Scope**：必须复用历史记录中已存在的 Scope 命名逻辑（除非是全新的模块）。
    *   **格式**：严格遵守下方的 [提交信息规范]，但措辞风格向历史记录靠拢。

### 5. 执行提交 (Execute Commit)

使用生成的提交信息执行 Git 提交命令。

- **命令格式**：使用标准的 `git commit -m "你的提交标题" -m "你的提交正文(可选)"`。
- **关于签名**：**不要**在命令中显式添加 `-S` 参数。请依赖 Git 的本地配置（如 `commit.gpgsign`）来自动处理签名。
- 如果提交信息包含正文，请确保通过多个 `-m` 参数或换行符正确传递。

---

## 提交信息规范 (Commit Standards)

### 格式结构
```text
<emoji> <类型>[可选范围]: <描述>

[可选正文：详细解释变更原因和内容]

[可选页脚：关联 Issue 或破坏性变更说明]
```

### Emoji 与类型对照表
| Emoji | 类型 (Type) | 适用场景 |
| :--- | :--- | :--- |
| ✨ | `feat` | 引入新功能 (Minor version) |
| 🐛 | `fix` | 修复 Bug (Patch version) |
| 📚 | `docs` | 仅修改文档 |
| 🎨 | `style` | 代码格式调整 (空格、分号等，不影响逻辑) |
| ♻️ | `refactor` | 代码重构 (非新增功能也非修复 Bug) |
| ⚡️ | `perf` | 性能优化 |
| 🧪 | `test` | 添加或修改测试 |
| 📦 | `build` | 构建系统或外部依赖变更 |
| 🚀 | `ci` | CI/CD 配置变更 |
| 🧹 | `chore` | 日常维护、工具配置等 |
| ⏪ | `revert` | 撤销之前的提交 |

---

## 示例场景

**场景 1：历史记录显示 Scope 偏好模块名**
*   你执行 `git log` 发现记录多为 `feat(auth): ...`, `fix(payment): ...`。
*   当前修改了 `src/login/utils.ts`。
*   你生成的信息应为：`✨ feat(auth): 添加登录重试机制` (而不是 `feat(utils)` 或 `feat(login/utils)`)。

**场景 2：用户完全没操作 Git，直接让你提交**
*   你执行状态检查 -> `git add .` -> 读取 `src/api.ts`。
*   你执行 `git log`，发现最近都是 `⚡️ perf(network): ...` 风格。
*   你提交：`git commit -m "⚡️ perf(network): 调整请求超时时间以优化体验"`。

---

## 开始执行
请立即按照【步骤 1】检查暂存区状态，并开始流程。
